# 定义

1. 有两名选手；
2. 两名选手交替对游戏进行移动(move)，每次一步，选手可以在（一般而言）有限的合法移动集合中任选一种进行移动；
3. 对于游戏的任何一种可能的局面，合法的移动集合只取决于这个局面本身，不取决于轮到哪名选手操作、以前的任何操作、骰子的点数或者其它什么因素； 
4. 如果轮到某名选手移动，且这个局面的合法的移动集合为空（也就是说此时无法进行移动），则这名选手负。

根据这个定义，很多日常的游戏并非ICG。例如象棋就不满足条件3，因为红方只能移动红子，黑方只能移动黑子，合法的移动集合取决于轮到哪名选手操作。

在定义P-position和N-position：

P-position
  ~ 可以移动到P-position的局面是N-position
  ~ P-position表示无法进行任何移动的局面
N-position
 ~ 只能移动到N-position的局面是P-position

也就是说P-position是`后手必胜`，N-position是`先手必胜`。

## 例子

~ Example
给出n列珍珠，两人轮流取珍珠，每次在某一列中取至少1颗珍珠，但不能在两列中取。最后拿光珍珠的人输。
~

后来，在一份资料上看到，这种游戏称为“拈（Nim）”。据说，它源自中国，经由被贩卖到美洲的奴工们外传。辛苦的工人们，在工作闲暇之余，用石头玩游戏以排遣寂寞。后来流传到高级人士，则用便士（Pennies），在酒吧柜台上玩。

以Nim游戏为例来进行一下计算。比如说我刚才说当只有两堆石子且两堆石子数量相等时后手有必胜策略，也就是这是一个P-position，下面我们依靠定义证明一下(3,3)是一个P是一个P是一个P-position。首先(3,3)的子局面（也就是通过合法移动可以导致的局面）有(0,3)(1,3)(2,3)（显然交换石子堆的位置不影响其性质，所以把(x,y)和(y,x)看成同一种局面），只需要计算出这三种局面的性质就可以了。 (0,3)的子局面有(0,0)、(0,1)、(0,2)，其中(0,0)显然是P-position，所以(0,3)是N-position（只要找到一个是P-position的子局面就能说明是N-position）。(1,3)的后继中(1,1)是P-position（因为(1,1)的唯一子局面(0,1)是N-position），所以(1,3)也是N-position。同样可以证明(2,3)是N-position。所以(3,3)的所有子局面都是N-position，它就是P-position。通过一点简单的数学归纳，可以严格的证明“有两堆石子时的局面是P-position当且仅当这两堆石子的数目相等”。

根据上面这个过程，可以得到一个递归的算法——对于当前的局面，递归计算它的所有子局面的性质，如果存在某个子局面是P-position，那么向这个子局面的移动就是必胜策略。当然，可能你已经敏锐地看出有大量的重叠子问题，所以可以用DP或者记忆化搜索的方法以提高效率。但问题是，利用这个算法，对于某个Nim游戏的局面(a1,a2,...,an)来说，要想判断它的性质以及找出必胜策略，需要计算O(a1*a2*...*an)个局面的性质，不管怎样记忆化都无法降低这个时间复杂度。所以我们需要更高效的判断Nim游戏的局面的性质的方法。

# 结论

根据定义，证明一种判断position的性质的方法的正确性，只需证明三个命题： 
1. 这个判断将所有terminal position判为P-position；
2. 根据这个判断被判为N-position的局面一定可以移动到某个P-position；
3. 根据这个判断被判为P-position的局面无法移动到某个P-position。
该定理可以通过数学归纳法证明。

~Theorem {#th}
对于$k$堆硬币，每堆分别含有$N_1,N_2,\dots,N_k$。游戏的目的是选择最后剩下的硬币。规则如下：

1. 两个游戏者交替进行游戏

2. 当轮到每个游戏者取子时，选择这些堆中的一堆，并从所选的堆中取走至少一枚硬币

3. 当所有的堆为空时，最后取子的游戏者获胜

有以下结论：

对于一个Nim游戏的局面(a1,a2,...,ak)，它是P-position当且仅当`a1^a2^...^ak=0`，其中^表示异或(xor)运算。
~

~Proof {caption: Proof of Theorem [#th]}
只需依次证明上述三个命题即可。显然命题1正确，因为所有堆为空时，`0^0^0...^0=0`，局面为P-position。

对于命题2，若`a1^a2^...^ak=s!=0`，即为N-position，则表明至少存在ai，其二进制表示在s的最高位上是1，否则`a1^a2^...^ak`就无法得到s。比如`a1^a2^...^ak=100101`，那必存在ai二进制的第6高位上是1，那么`ai^s<ai`，那么游戏者直接取第i堆的`ai-ai^s`个硬币，就使得`a1^a2^...ai^s^...^ak=a1^a2^...^ak^s=0`，是一个P-position。

对于命题3，`a1^a2^...^ak=0`，如果`ai-->ai'`，`ai'=ai^s`（s一定存在，因为`ai'<ai`）那么`a1^a2^...^ai-1^(ai^s)^ai+1^...^ak=a1^a2^...^ai-1^ai^ai+1^...^ak^s=0^s!=0`，只能得到一个N-position。 &qed;
~